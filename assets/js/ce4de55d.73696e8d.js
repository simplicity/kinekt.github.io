"use strict";(self.webpackChunkmy_website=self.webpackChunkmy_website||[]).push([[978],{2138:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>l,contentTitle:()=>o,default:()=>h,frontMatter:()=>r,metadata:()=>s,toc:()=>c});const s=JSON.parse('{"id":"auto-generated-clients","title":"Auto-Generated Clients","description":"Serve it and call it","source":"@site/docs/auto-generated-clients.md","sourceDirName":".","slug":"/auto-generated-clients","permalink":"/docs/auto-generated-clients","draft":false,"unlisted":false,"tags":[],"version":"current","sidebarPosition":3,"frontMatter":{"sidebar_position":3},"sidebar":"tutorialSidebar","previous":{"title":"Pipelines","permalink":"/docs/pipelines"},"next":{"title":"File organization","permalink":"/docs/file-organization"}}');var a=t(6070),i=t(5658);const r={sidebar_position:3},o="Auto-Generated Clients",l={},c=[{value:"Serve it and call it",id:"serve-it-and-call-it",level:2},{value:"Handling results",id:"handling-results",level:2}];function d(e){const n={code:"code",h1:"h1",h2:"h2",header:"header",li:"li",p:"p",pre:"pre",ul:"ul",...(0,i.R)(),...e.components};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(n.header,{children:(0,a.jsx)(n.h1,{id:"auto-generated-clients",children:"Auto-Generated Clients"})}),"\n",(0,a.jsx)(n.h2,{id:"serve-it-and-call-it",children:"Serve it and call it"}),"\n",(0,a.jsxs)(n.p,{children:["When creating an endpoint with ",(0,a.jsx)(n.code,{children:"createSchematizedEndpointFactory"}),", you get an object which you can use in two ways:"]}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:"pass it to a server to serve the endpoint"}),"\n",(0,a.jsx)(n.li,{children:"call it to fetch the endpoint"}),"\n"]}),"\n",(0,a.jsx)(n.p,{children:"Create an endpoint:"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-TypeScript",children:"const createUser = app.createEndpoint(...);\n"})}),"\n",(0,a.jsx)(n.p,{children:"Serve it:"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-TypeScript",children:"const serve = createServer();\nserve(createUser, ...otherEndpoints);\n"})}),"\n",(0,a.jsx)(n.p,{children:"Call it:"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-TypeScript",children:"createUser(...);\n"})}),"\n",(0,a.jsxs)(n.p,{children:["The options you pass to the client (in this case, ",(0,a.jsx)(n.code,{children:"getUser"}),") are determined by the zod schemas you used to create the endpoint."]}),"\n",(0,a.jsx)(n.p,{children:"Note that you'll have to configure the base url that shall be used when calling the client. You might also want to pass an authorize header that shall be passed along the fetch call. You do that on the endpoint factory:"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-TypeScript",children:'app.setGlobalClientParams({\n  baseUrl: process.env.BASE_URL ?? "http://0.0.0.0:3000",\n  authorize: btoa("some authorization"),\n})\n'})}),"\n",(0,a.jsx)(n.h2,{id:"handling-results",children:"Handling results"}),"\n",(0,a.jsx)(n.p,{children:"When using a client function we expect to get a successful response most of the time. We can use the following syntax to express that we expect a specific status code. The client will throw an error in any other case:"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-TypeScript",children:'const user = await createUser({ email: "some@email.com" }).ok(200)\n'})}),"\n",(0,a.jsx)(n.p,{children:"We might have scenarios where we want to handle the results more throroughly. We can use this syntax:"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-TypeScript",children:'createUser({ email: "some@email.com" })\n  .all()\n  .then((result) => {\n    switch (result.type) {\n      case "ok": {\n        switch (result.value.statusCode) {\n          case 200: {\n            ...\n          }\n          case 409: {\n            ...\n          }\n          case 400: {\n            ...\n          }\n          case 401: {\n            ...\n          }\n        }\n      }\n      case "error": {\n        ...\n      }\n    }\n  });\n'})}),"\n",(0,a.jsxs)(n.p,{children:["Note that the value of ",(0,a.jsx)(n.code,{children:"result.value.statusCode"})," depends both on the definition of your endpoint as well as the underlying pipeline. If you define your endpoint to return ",(0,a.jsx)(n.code,{children:"200"})," and ",(0,a.jsx)(n.code,{children:"409"}),", you'll have to handle these. If you have a middleware like ",(0,a.jsx)(n.code,{children:"authenticate()"})," in your pipeline, you'll have to handle the status code it produces, which is ",(0,a.jsx)(n.code,{children:"401"}),". When using schematized endpoints, you might have validation errors, so you'll also have to handle ",(0,a.jsx)(n.code,{children:"400"}),". All of this is typesafe: the compiler will complain if you try to handle status codes which a particular endpoint doesn't return."]})]})}function h(e={}){const{wrapper:n}={...(0,i.R)(),...e.components};return n?(0,a.jsx)(n,{...e,children:(0,a.jsx)(d,{...e})}):d(e)}},5658:(e,n,t)=>{t.d(n,{R:()=>r,x:()=>o});var s=t(758);const a={},i=s.createContext(a);function r(e){const n=s.useContext(i);return s.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(a):e.components||a:r(e.components),s.createElement(i.Provider,{value:n},e.children)}}}]);